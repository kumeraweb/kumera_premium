<section id="contacto" class="relative bg-white">
  <div
    class="mx-auto w-full max-w-[1120px] px-6 grid gap-16 py-16 md:grid-cols-[1.1fr_0.9fr] md:py-24"
  >
    <div class="space-y-8">
      <p class="py-1.5 text-xs font-semibold uppercase tracking-[0.26em] text-black/40">Contacto</p>
      <h2
        class="font-['Space_Grotesk'] text-4xl leading-[1.1] tracking-tight text-black md:text-5xl"
      >
        Cuéntanos tu proyecto y definamos el próximo paso
      </h2>
      <p class="py-1.5 max-w-[65ch] text-base text-black/70 md:text-lg">
        ¿Tienes una idea o un proyecto en mente? Escríbenos y veamos si podemos ayudarte a llevarlo
        a buen puerto.
      </p>
    </div>

    <div data-contact-stage class="border border-black/10 bg-white p-8">
      <form class="space-y-8" method="POST" action="/api/contact">
        <div class="space-y-2">
          <label class="text-xs uppercase tracking-[0.2em] text-black/50">Nombre</label>
          <input
            name="nombre"
            type="text"
            placeholder="Tu nombre"
            class="w-full border-b border-black/30 bg-transparent pb-3 text-sm text-black outline-none focus:border-black"
          />
          <p class="hidden text-xs text-red-600" data-error-for="nombre"></p>
        </div>

        <div class="space-y-2">
          <label class="text-xs uppercase tracking-[0.2em] text-black/50">Email</label>
          <input
            name="email"
            type="text"
            placeholder="tu@email.com"
            class="w-full border-b border-black/30 bg-transparent pb-3 text-sm text-black outline-none focus:border-black"
          />
          <p class="hidden text-xs text-red-600" data-error-for="email"></p>
        </div>

        <div class="space-y-2">
          <label class="text-xs uppercase tracking-[0.2em] text-black/50">
            Tipo de proyecto <span class="text-[0.7rem] normal-case">(opcional)</span>
          </label>
          <input
            name="tipo"
            type="text"
            placeholder="Sitio web, Google Ads, Ecommerce..."
            class="w-full border-b border-black/30 bg-transparent pb-3 text-sm text-black outline-none focus:border-black"
          />
        </div>

        <div class="space-y-2">
          <label class="text-xs uppercase tracking-[0.2em] text-black/50">
            Mensaje <span class="text-[0.7rem] normal-case">(opcional)</span>
          </label>
          <textarea
            name="mensaje"
            placeholder="Cuéntanos brevemente tu necesidad"
            class="min-h-[120px] w-full resize-none border-b border-black/30 bg-transparent pb-3 text-sm text-black outline-none focus:border-black"
          ></textarea>
        </div>

        <div class="flex justify-center pt-8">
          <button
            type="submit"
            class="inline-flex items-center justify-center rounded-full bg-black px-8 py-3 text-xs font-semibold uppercase tracking-[0.2em] text-white transition hover:opacity-90"
          >
            Enviar mensaje
          </button>
        </div>
        <p class="text-xs text-black/60" aria-live="polite" data-status></p>
      </form>

      <div class="hidden space-y-3" data-contact-success>
        <h3 class="font-['Space_Grotesk'] text-2xl text-black">Mensaje enviado</h3>
        <p class="text-sm text-black/70">
          Gracias por escribirnos. Revisaremos tu proyecto y te contactaremos muy pronto.
        </p>
      </div>
    </div>
  </div>
</section>

<script is:inline>
  const stage = document.querySelector('[data-contact-stage]')
  if (stage) {
    const form = stage.querySelector('form')
    const statusEl = stage.querySelector('[data-status]')
    const successEl = stage.querySelector('[data-contact-success]')

    form.addEventListener('submit', async (event) => {
      event.preventDefault()
      const submitButton = form.querySelector('button[type="submit"]')
      const originalText = submitButton.textContent

      const nombreInput = form.querySelector('input[name="nombre"]')
      const emailInput = form.querySelector('input[name="email"]')
      const nombreError = form.querySelector('[data-error-for="nombre"]')
      const emailError = form.querySelector('[data-error-for="email"]')

      const clearErrors = () => {
        ;[nombreError, emailError].forEach((el) => {
          el.textContent = ''
          el.classList.add('hidden')
        })
      }

      clearErrors()

      let hasError = false
      const nombre = nombreInput.value.trim()
      if (nombre.length < 2) {
        nombreError.textContent = '¿Podrías indicarnos tu nombre?'
        nombreError.classList.remove('hidden')
        hasError = true
      }

      const email = emailInput.value.trim().toLowerCase()
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/

      if (!emailRegex.test(email)) {
        emailError.textContent = 'Revisa el formato del email.'
        emailError.classList.remove('hidden')
        hasError = true
      } else {
        const commonTypos = {
          'gmiil.com': 'gmail.com',
          'gmial.com': 'gmail.com',
          'gmaill.com': 'gmail.com',
          'hotmial.com': 'hotmail.com',
          'hotmil.com': 'hotmail.com',
          'outlok.com': 'outlook.com'
        }

        const domain = email.split('@')[1]
        if (commonTypos[domain]) {
          emailError.textContent = `¿Quisiste decir ${email.split('@')[0]}@${commonTypos[domain]}?`
          emailError.classList.remove('hidden')
          hasError = true
        }
      }

      if (hasError) return

      submitButton.disabled = true
      submitButton.textContent = 'Enviando...'
      statusEl.textContent = ''

      try {
        const formData = new FormData(form)
        const response = await fetch('/api/contact', {
          method: 'POST',
          body: formData
        })

        if (response.ok) {
          form.classList.add('hidden')
          successEl.classList.remove('hidden')
        } else {
          submitButton.disabled = false
          submitButton.textContent = originalText
          statusEl.textContent = 'Hubo un problema al enviar. Intenta nuevamente.'
        }
      } catch {
        submitButton.disabled = false
        submitButton.textContent = originalText
        statusEl.textContent = 'No se pudo enviar. Intenta nuevamente.'
      }
    })
  }
</script>
