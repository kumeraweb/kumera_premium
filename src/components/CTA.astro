<section class="km-cta" id="contacto">
  <div class="cta-flex">
    <div class="km-container">
      <h2 class="contact-title reveal-on-scroll">¿Listo para comenzar algo increíble?</h2>

      <p class="contact-subtitle reveal-on-scroll">
        Cuéntanos sobre tu proyecto y te responderemos en menos de 24 horas.
      </p>

      <form class="contact-form reveal-on-scroll" method="POST" action="/api/contact">
        <div class="field-group">
          <label>Nombre</label>
          <input name="nombre" type="text" placeholder="Tu nombre" required />
        </div>

        <div class="field-group">
          <label>Email</label>
          <input name="email" type="email" placeholder="tu@email.com" required />
        </div>

        <div class="field-group">
          <label>Tipo de proyecto</label>
          <input name="tipo" type="text" placeholder="Sitio Web, App, Google Ads…" />
        </div>

        <div class="field-group">
          <label>Mensaje</label>
          <textarea name="mensaje" placeholder="Cuéntanos brevemente en qué puedo ayudarte"
          ></textarea>
        </div>

        <button type="submit" class="contact-submit"> Enviar mensaje → </button>
        <p class="contact-status" aria-live="polite"></p>
      </form>
    </div>
    <!-- end km-container -->

    <div class="cta-pattern" aria-hidden="true">
      <svg viewBox="0 0 400 600" preserveAspectRatio="xMidYMid slice">
        <line x1="50" y1="0" x2="350" y2="600" stroke="rgba(0,0,0,0.08)" stroke-width="1"></line>
        <line x1="150" y1="0" x2="450" y2="600" stroke="rgba(0,0,0,0.08)" stroke-width="1"></line>
        <line x1="250" y1="0" x2="550" y2="600" stroke="var(--color-accent)" stroke-width="1"
        ></line>

        <line
          x1="100"
          y1="0"
          x2="400"
          y2="600"
          stroke="rgba(0,0,0,0.08)"
          stroke-width="1.5"
          opacity="0.35"></line>
      </svg>
    </div>
  </div>
  <!-- end cta-flex -->
</section>

<style>
  .km-cta {
    padding: 6rem 0 8rem;
    background: #ffffff;
    color: #111;
    position: relative;
  }

  .contact-title {
    font-family: var(--font-heading);
    font-size: clamp(2.4rem, 5vw, 3.6rem);
    line-height: 1.1;
    max-width: 22ch;
    margin-bottom: 1.2rem;
  }

  .contact-subtitle {
    font-size: 1.2rem;
    opacity: 0.65;
    max-width: 48ch;
    margin-bottom: 3rem;
    line-height: 1.55;
  }

  .contact-form {
    max-width: 600px;
    display: flex;
    flex-direction: column;
    gap: 1.8rem;
  }

  .field-group {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }

  .field-group label {
    font-size: 0.95rem;
    opacity: 0.7;
  }

  .field-group input,
  .field-group textarea {
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding: 0.6rem 0;
    font-size: 1rem;
    font-family: var(--font-body);
    background: transparent;
    outline: none;
    transition: border-color 0.2s ease;
  }

  .field-group input:focus,
  .field-group textarea:focus {
    border-color: #111;
  }

  .field-group textarea {
    min-height: 120px;
    resize: none;
  }

  .contact-submit {
    margin-top: 1rem;
    font-size: 1rem;
    background: #111;
    color: #fff;
    padding: 0.9rem 1.6rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    letter-spacing: -0.01em;
    transition:
      opacity 0.25s ease,
      transform 0.25s ease;
    width: fit-content;
  }

  .contact-submit:hover {
    opacity: 0.8;
    transform: translateX(4px);
  }

  .contact-status {
    margin-top: 0.6rem;
    font-size: 0.9rem;
    min-height: 1.2em;
    opacity: 0.85;
  }

  .contact-status.success {
    color: #15803d; /* green-700 approximated */
  }

  .contact-status.error {
    color: #b91c1c; /* red-700 approximated */
  }

  .cta-pattern {
    position: absolute;
    top: 0;
    right: 0;
    width: 40%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
    display: block;
  }

  .cta-pattern svg {
    width: 100%;
    height: 100%;
    opacity: 0.7;
  }

  @keyframes slowDriftY {
    0% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-12px);
    }
    100% {
      transform: translateY(0);
    }
  }

  .cta-pattern svg {
    animation: slowDriftY 14s ease-in-out infinite;
  }

  .cta-flex {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 4rem;
  }

  .km-container {
    width: 50%;
    z-index: 2;
    position: relative;
  }

  .cta-pattern {
    width: 50%;
    height: 100%;
    display: flex;
    align-items: stretch;
    justify-content: flex-end;
  }

  .cta-pattern svg {
    width: 100%;
    height: 100%;
    opacity: 0.6;
  }

  @media (max-width: 768px) {
    .km-cta {
      padding: 4rem 1.6rem 6rem;
    }

    .contact-form {
      max-width: 100%;
    }

    .cta-flex {
      flex-direction: column;
    }

    .km-container {
      width: 100%;
    }

    .cta-pattern {
      display: none;
    }
  }
</style>
<script is:inline>
  const form = document.querySelector('.contact-form')
  const statusEl = document.querySelector('.contact-status')

  if (form) {
    form.addEventListener('submit', async (event) => {
      event.preventDefault()

      const submitButton = form.querySelector('.contact-submit')
      const originalText = submitButton?.textContent || 'Enviar mensaje →'

      if (statusEl) {
        statusEl.textContent = ''
        statusEl.classList.remove('success', 'error')
      }

      if (submitButton) {
        submitButton.disabled = true
        submitButton.textContent = 'Enviando...'
      }

      try {
        const formData = new FormData(form)
        const response = await fetch('/api/contact', {
          method: 'POST',
          body: formData
        })

        if (response.ok) {
          form.reset()
          if (statusEl) {
            statusEl.textContent = 'Gracias, hemos recibido tu mensaje.'
            statusEl.classList.add('success')
          }
        } else {
          if (statusEl) {
            statusEl.textContent = 'Hubo un problema al enviar tu mensaje. Inténtalo nuevamente.'
            statusEl.classList.add('error')
          }
        }
      } catch (error) {
        if (statusEl) {
          statusEl.textContent =
            'No pudimos enviar tu mensaje. Revisa tu conexión e inténtalo de nuevo.'
          statusEl.classList.add('error')
        }
      } finally {
        if (submitButton) {
          submitButton.disabled = false
          submitButton.textContent = originalText
        }
      }
    })
  }
</script>
